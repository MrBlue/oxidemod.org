---
layout: forums
title: 'Request - New OnItemCraftStart Hook(Rust) - Called at Time of Actual Crafting'
breadcrumbs:
 - "Feature Suggestions": "/forums/feature-suggestions.6/"
---
<div class="titleBar">
    <h1>
        <span class="prefix prefixOrange">Request</span> <a href="{{ '/threads/new-onitemcraftstart-hook-rust-called-at-time-of-actual-crafting.29218/' | prepend: site.baseurl }}">New OnItemCraftStart
            Hook(Rust) - Called at Time of Actual Crafting</a>
    </h1>
    <p id="pageDescription" class="muted">Discussion in '<a href="{{ '/forums/feature-suggestions.6/' | prepend: site.baseurl }}">Feature Suggestions</a>' started by <a class="username"
            dir="auto">Abnormal Zombie</a>, <a href="{{ '/threads/new-onitemcraftstart-hook-rust-called-at-time-of-actual-crafting.29218/' | prepend: site.baseurl }}"><span class="DateTime"
                title="Jan 28, 2018 at 4:42 AM">Jan 28, 2018</span></a>.
    </p>
</div>
<ol class="messageList" id="messageList">
    <li id="post-382538" class="message" data-author="Abnormal Zombie">
        <div class="messageUserInfo">
            <div class="messageUserBlock">
                <div class="avatarHolder">
                    <span class="helper"></span>
                    <a class="avatar Avm" data-avatarhtml="true"><img src="{{ '/assets/styles/oxide/logo.og.png' | prepend: site.baseurl }}" width="96" height="96" alt="Abnormal Zombie" /></a>
                </div>
                <h3 class="userText">
                    <a class="username" dir="auto">Abnormal Zombie</a>
                </h3>
                <span class="arrow"></span>
            </div>
        </div>
        <div class="messageInfo primaryContent">
            <div class="messageContent">
                <article>
                    <blockquote class="messageText SelectQuoteContainer ugc baseHtml">
                        <b>Please read my second post, as my request has changed.</b><br />
                        <br /> I was wondering if &quot;base.baseEntity&quot; could be passed in as one of the arguments in the CanCraft hook found in PlayerBlueprints (there&#039;s another one found
                        in ItemCrafter with different parameters) so that I can set/get values of the player before the crafting begins.<br />
                        <br />
                        <div class="bbCodeBlock bbCodeCode">
                            <div class="type">Code:</div>
                            {% raw %}<pre>object[] objArray = new object[] { this, itemDefinition, skinItemId };
        object obj = Interface.CallHook(&quot;CanCraft&quot;, objArray);</pre>{% endraw %}
                        </div>to...<br />
                        <br />
                        <div class="bbCodeBlock bbCodeCode">
                            <div class="type">Code:</div>
                            {% raw %}<pre>object[] objArray = new object[] { this, itemDefinition, skinItemId, base.baseEntity };
        object obj = Interface.CallHook(&quot;CanCraft&quot;, objArray);</pre>{% endraw %}
                        </div>Thanks. <div class="messageTextEndMarker">&nbsp;</div>
                    </blockquote>
                </article>
            </div>
            <div class="editDate"> Last edited by a moderator: <span class="DateTime" title="Jan 29, 2018 at 4:03 AM">Jan 29, 2018</span>
            </div>
            <div class="messageMeta ToggleTriggerAnchor">
                <div class="privateControls">
                    <span class="item muted">
                        <span class="authorEnd"><a class="username author" dir="auto">Abnormal Zombie</a>,</span>
                        <a href="{{ '/threads/new-onitemcraftstart-hook-rust-called-at-time-of-actual-crafting.29218/' | prepend: site.baseurl }}" title="Permalink" class="datePermalink"><span
                                class="DateTime" title="Jan 28, 2018 at 4:42 AM">Jan 28, 2018</span></a>
                    </span>
                </div>
                <div class="publicControls">
                    <a href="{{ '/threads/new-onitemcraftstart-hook-rust-called-at-time-of-actual-crafting.29218/' | prepend: site.baseurl }}" title="Permalink"
                        class="item muted postNumber hashPermalink OverlayTrigger" data-href="posts/382538/permalink">#1</a>
                </div>
            </div>
        </div>
    </li>
    <li id="post-382704" class="message" data-author="redBDGR">
        <div class="messageUserInfo">
            <div class="messageUserBlock">
                <div class="avatarHolder">
                    <span class="helper"></span>
                    <a class="avatar Avm" data-avatarhtml="true"><img src="{{ '/assets/styles/oxide/logo.og.png' | prepend: site.baseurl }}" width="96" height="96" alt="redBDGR" /></a>
                </div>
                <h3 class="userText">
                    <a class="username" dir="auto">redBDGR</a>
                </h3>
                <span class="arrow"></span>
            </div>
        </div>
        <div class="messageInfo primaryContent">
            <div class="messageContent">
                <article>
                    <blockquote class="messageText SelectQuoteContainer ugc baseHtml"> Could you use this hook instead? -&gt; <b><span style="text-decoration: underline"><a
                                    href="http://docs.oxidemod.org/rust/#onitemcraft" target="_blank" class="externalLink" rel="nofollow">OnItemCraft(ItemCraftTask item)</a></span></b><br /> Or even
                        this -&gt; <b><span style="text-decoration: underline"><a href="http://docs.oxidemod.org/rust/#cancraft" target="_blank" class="externalLink  rel="
                                    nofollow">CanCraft(ItemCrafter itemCrafter, ItemBlueprint bp, int amount)</a></span></b>
                        <div class="messageTextEndMarker">&nbsp;</div>
                    </blockquote>
                </article>
            </div>
            <div class="messageMeta ToggleTriggerAnchor">
                <div class="privateControls">
                    <span class="item muted">
                        <span class="authorEnd"><a class="username author" dir="auto">redBDGR</a>,</span>
                        <a href="{{ '/threads/new-onitemcraftstart-hook-rust-called-at-time-of-actual-crafting.29218/#post-382704' | prepend: site.baseurl }}" title="Permalink"
                            class="datePermalink"><span class="DateTime" title="Jan 29, 2018 at 2:05 AM">Jan 29, 2018</span></a>
                    </span>
                </div>
                <div class="publicControls">
                    <a href="{{ '/threads/new-onitemcraftstart-hook-rust-called-at-time-of-actual-crafting.29218/#post-382704' | prepend: site.baseurl }}" title="Permalink"
                        class="item muted postNumber hashPermalink OverlayTrigger" data-href="posts/382704/permalink">#2</a>
                </div>
            </div>
        </div>
    </li>
    <li id="post-382719" class="message" data-author="Abnormal Zombie">
        <div class="messageUserInfo">
            <div class="messageUserBlock">
                <div class="avatarHolder">
                    <span class="helper"></span>
                    <a class="avatar Avm" data-avatarhtml="true"><img src="{{ '/assets/styles/oxide/logo.og.png' | prepend: site.baseurl }}" width="96" height="96" alt="Abnormal Zombie" /></a>
                </div>
                <h3 class="userText">
                    <a class="username" dir="auto">Abnormal Zombie</a>
                </h3>
                <span class="arrow"></span>
            </div>
        </div>
        <div class="messageInfo primaryContent">
            <div class="messageContent">
                <article>
                    <blockquote class="messageText SelectQuoteContainer ugc baseHtml"> OnItemCraft and both CanCraft Hooks aren&#039;t called when the crafting actually begins. For instance, if an
                        item is added to a crafting queue, but not actually being crafted, these hooks are still called even and the ItemCraftTask object has not yet been assigned specific
                        values.<br />
                        <br /> Instead of my original request, I&#039;d like to propose a new hook called OnItemCraftStart, which would go nicely with OnItemCraftCancelled and OnItemCraftFinished.
                        This hook would be called at the exact time of actual crafting. I can suggest the location to put it, as seen below:<br />
                        <br />
                        <br /> Current code:<br />
                        <div class="bbCodeBlock bbCodeCode">
                            <div class="type">Code:</div>
                            {% raw %}<pre>
ItemCrafter line 330:
 
        float scaledDuration = ItemCrafter.GetScaledDuration(itemCraftTask.blueprint, single);
        itemCraftTask.endTime = Time.realtimeSinceStartup + scaledDuration;
        if (itemCraftTask.owner != null)
        {
            itemCraftTask.owner.Command(&quot;note.craft_start&quot;, new object[] { itemCraftTask.taskUID, scaledDuration, itemCraftTask.amount });
            if (itemCraftTask.owner.IsAdmin &amp;&amp; Craft.instant)
            {
                itemCraftTask.endTime = Time.realtimeSinceStartup + 1f;
            }
        }
</pre>{% endraw %}
                        </div>As you can see, this is when the actual crafting time (endTime) is initialized for the item about to begin being crafted<br />
                        <br /> Below, I&#039;ve inserted the new code between scaledDuration and the itemCraftTask.endTime initialization so that the duration of the craft can be changed by a
                        reference, which will influence the timer made client side (since it is being passed to the Command method further below), and it will change the time of crafting server side,
                        since endTime is dependant on the value.<br />
                        <br />
                        <b>Here&#039;s my suggested change:</b><br />
                        <div class="bbCodeBlock bbCodeCode">
                            <div class="type">Code:</div>
                            {% raw %}<pre>
ItemCrafter line 330:
 
        float scaledDuration = ItemCrafter.GetScaledDuration(itemCraftTask.blueprint, single);
►►►►►►►►►object[] objArray = new object[] { itemCraftTask, ref scaledDuration };
►►►►►►►►►Interface.CallHook(&quot;OnItemCraftStart&quot;, objArray);
        itemCraftTask.endTime = Time.realtimeSinceStartup + scaledDuration;
        if (itemCraftTask.owner != null)
        {
            itemCraftTask.owner.Command(&quot;note.craft_start&quot;, new object[] { itemCraftTask.taskUID, scaledDuration, itemCraftTask.amount });
            if (itemCraftTask.owner.IsAdmin &amp;&amp; Craft.instant)
            {
                itemCraftTask.endTime = Time.realtimeSinceStartup + 1f;
            }
        }
</pre>{% endraw %}
                        </div>As I see it now, there&#039;s no other clean way to change the time it takes to craft an item. Although that is one good purpose of the hook, I&#039;m sure there are
                        others. <div class="messageTextEndMarker">&nbsp;</div>
                    </blockquote>
                </article>
            </div>
            <div class="editDate"> Last edited by a moderator: <span class="DateTime" title="Jan 29, 2018 at 4:39 AM">Jan 29, 2018</span>
            </div>
            <div class="messageMeta ToggleTriggerAnchor">
                <div class="privateControls">
                    <span class="item muted">
                        <span class="authorEnd"><a class="username author" dir="auto">Abnormal Zombie</a>,</span>
                        <a href="{{ '/threads/new-onitemcraftstart-hook-rust-called-at-time-of-actual-crafting.29218/#post-382719' | prepend: site.baseurl }}" title="Permalink"
                            class="datePermalink"><span class="DateTime" title="Jan 29, 2018 at 3:58 AM">Jan 29, 2018</span></a>
                    </span>
                </div>
                <div class="publicControls">
                    <a href="{{ '/threads/new-onitemcraftstart-hook-rust-called-at-time-of-actual-crafting.29218/#post-382719' | prepend: site.baseurl }}" title="Permalink"
                        class="item muted postNumber hashPermalink OverlayTrigger" data-href="posts/382719/permalink">#3</a>
                </div>
            </div>
        </div>
    </li>
</ol>
