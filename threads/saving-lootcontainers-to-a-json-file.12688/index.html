---
layout: forums
title: 'Solved - Saving LootContainers to a JSON file?'
breadcrumbs:
 - "Plugin Development": "/forums/plugin-development.105/"
 - "Rust Development": "/forums/rust-development.4/"
---
<div class="titleBar">
    <h1>
        <span class="prefix prefixGreen">Solved</span> <a href="{{ '/threads/saving-lootcontainers-to-a-json-file.12688/' | prepend: site.baseurl }}">Saving LootContainers to a JSON file?</a>
    </h1>
    <p id="pageDescription" class="muted">Discussion in '<a href="{{ '/forums/rust-development.4/' | prepend: site.baseurl }}">Rust Development</a>' started by <a class="username"
            dir="auto">Mythikos</a>, <a href="{{ '/threads/saving-lootcontainers-to-a-json-file.12688/' | prepend: site.baseurl }}"><span class="DateTime" title="Nov 9, 2015 at 5:05 AM">Nov 9,
                2015</span></a>.
    </p>
</div>
<ol class="messageList" id="messageList">
    <li id="post-142379" class="message" data-author="Mythikos">
        <div class="messageUserInfo">
            <div class="messageUserBlock">
                <div class="avatarHolder">
                    <span class="helper"></span>
                    <a class="avatar Avm" data-avatarhtml="true"><img src="{{ '/assets/styles/oxide/logo.og.png' | prepend: site.baseurl }}" width="96" height="96" alt="Mythikos" /></a>
                </div>
                <h3 class="userText">
                    <a class="username" dir="auto">Mythikos</a>
                </h3>
                <span class="arrow"></span>
            </div>
        </div>
        <div class="messageInfo primaryContent">
            <div class="messageContent">
                <article>
                    <blockquote class="messageText SelectQuoteContainer ugc baseHtml"> I am creating a mod called Tyranny. In the mod I am allowing taxation on the players. I wanted to save a crate
                        specified by a player as the &quot;tax box.&quot; Is it possible to store a StorageContainer in a json file? Every time I did it I got an error saying there is a self
                        referencing loop in Vector3.<br />
                        <br /> If it isnt possible to save a StorageContainer Object, can someone suggest another means perhaps saving the item?Any help or thoughts would be much appreciated. This is
                        being coded in C#. <div class="messageTextEndMarker">&nbsp;</div>
                    </blockquote>
                </article>
            </div>
            <div class="editDate"> Last edited by a moderator: <span class="DateTime" title="Nov 9, 2015 at 12:06 PM">Nov 9, 2015</span>
            </div>
            <div class="messageMeta ToggleTriggerAnchor">
                <div class="privateControls">
                    <span class="item muted">
                        <span class="authorEnd"><a class="username author" dir="auto">Mythikos</a>,</span>
                        <a href="{{ '/threads/saving-lootcontainers-to-a-json-file.12688/' | prepend: site.baseurl }}" title="Permalink" class="datePermalink"><span class="DateTime"
                                title="Nov 9, 2015 at 5:05 AM">Nov 9, 2015</span></a>
                    </span>
                </div>
                <div class="publicControls">
                    <a href="{{ '/threads/saving-lootcontainers-to-a-json-file.12688/' | prepend: site.baseurl }}" title="Permalink" class="item muted postNumber hashPermalink OverlayTrigger"
                        data-href="posts/142379/permalink">#1</a>
                </div>
            </div>
        </div>
    </li>
    <li id="post-142389" class="message staff" data-author="Calytic">
        <div class="messageUserInfo">
            <div class="messageUserBlock">
                <div class="avatarHolder">
                    <span class="helper"></span>
                    <a href="members/calytic.58712/" class="avatar Avm" data-avatarhtml="true"><img src="data/avatars/m/58/58712.jpg?1463423255" width="96" height="96" alt="Calytic" /></a>
                </div>
                <h3 class="userText">
                    <a href="members/calytic.58712/" class="username" dir="auto" itemprop="name">Calytic</a>
                    <em class="userBanner bannerRed wrapped" itemprop="title"><span class="before"></span><strong>Community Admin</strong><span class="after"></span></em>
                    <em class="userBanner bannerGreen wrapped" itemprop="title"><span class="before"></span><strong>Community Mod</strong><span class="after"></span></em>
                </h3>
                <span class="arrow"></span>
            </div>
        </div>
        <div class="messageInfo primaryContent">
            <div class="messageContent">
                <article>
                    <blockquote class="messageText SelectQuoteContainer ugc baseHtml">
                        <div class="bbCodeBlock bbCodeCode">
                            <div class="type">Code:</div>
                            {% raw %}<pre>DynamicConfigFile file = Interface.GetMod().DataFileSystem.GetDatafile(&quot;mydatafile&quot;);
file.Settings.ReferenceLoopHandling = ReferenceLoopHandling.Ignore;</pre>{% endraw %}
                        </div>
                        <div class="messageTextEndMarker">&nbsp;</div>
                    </blockquote>
                </article>
            </div>
            <div class="messageMeta ToggleTriggerAnchor">
                <div class="privateControls">
                    <span class="item muted">
                        <span class="authorEnd"><a href="members/calytic.58712/" class="username author" dir="auto">Calytic</a>,</span>
                        <a href="{{ '/threads/saving-lootcontainers-to-a-json-file.12688/#post-142389' | prepend: site.baseurl }}" title="Permalink" class="datePermalink"><span class="DateTime"
                                title="Nov 9, 2015 at 5:36 AM">Nov 9, 2015</span></a>
                    </span>
                </div>
                <div class="publicControls">
                    <a href="{{ '/threads/saving-lootcontainers-to-a-json-file.12688/#post-142389' | prepend: site.baseurl }}" title="Permalink"
                        class="item muted postNumber hashPermalink OverlayTrigger" data-href="posts/142389/permalink">#2</a>
                </div>
            </div>
        </div>
    </li>
    <li id="post-142399" class="message" data-author="Mythikos">
        <div class="messageUserInfo">
            <div class="messageUserBlock">
                <div class="avatarHolder">
                    <span class="helper"></span>
                    <a class="avatar Avm" data-avatarhtml="true"><img src="{{ '/assets/styles/oxide/logo.og.png' | prepend: site.baseurl }}" width="96" height="96" alt="Mythikos" /></a>
                </div>
                <h3 class="userText">
                    <a class="username" dir="auto">Mythikos</a>
                </h3>
                <span class="arrow"></span>
            </div>
        </div>
        <div class="messageInfo primaryContent">
            <div class="messageContent">
                <article>
                    <blockquote class="messageText SelectQuoteContainer ugc baseHtml">
                        <div class="bbCodeBlock bbCodeQuote" data-author="Calytic">
                            <aside>
                                <div class="attribution type">Calytic said: <a href="#post-142389" class="AttributionLink">&uarr;</a>
                                </div>
                                <blockquote class="quoteContainer">
                                    <div class="quote">
                                        <div class="bbCodeBlock bbCodeCode">
                                            <div class="type">Code:</div>
                                            {% raw %}<pre>DynamicConfigFile file = Interface.GetMod().DataFileSystem.GetDatafile(&quot;mydatafile&quot;);
file.Settings.ReferenceLoopHandling = ReferenceLoopHandling.Ignore;</pre>{% endraw %}
                                        </div>
                                    </div>
                                    <div class="quoteExpand">Click to expand...</div>
                                </blockquote>
                            </aside>
                        </div>
                        <div class="bbCodeBlock bbCodeCode">
                            <div class="type">Code:</div>
                            {% raw %}<pre>
DynamicConfigFile data = Interface.GetMod().DataFileSystem.GetDatafile(path);
            data.Settings.ReferenceLoopHandling = ReferenceLoopHandling.Ignore;</pre>{% endraw %}
                        </div>I added that too my dynamic file and this is still the output I get:<br />
                        <div class="bbCodeBlock bbCodeCode">
                            <div class="type">Code:</div>
                            {% raw %}<pre>
[Oxide] 10:27 PM [Info] [Tyranny] Tyranny was unsuccessful unloaded/saved: Self referencing loop detected for property 'normalized' with type 'UnityEngine.Vector3'. Path 'KingData.TaxBox.dropPosition.normalized.normalized'.  at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.CheckForCircularReference (Newtonsoft.Json.JsonWriter writer, System.Object value, Newtonsoft.Json.Serialization.JsonProperty property, Newtonsoft.Json.Serialization.JsonContract contract, Newtonsoft.Json.Serialization.JsonContainerContract containerContract, Newtonsoft.Json.Serialization.JsonProperty containerProperty) [0x00000] in &lt;filename unknown&gt;:0 
  at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.CalculatePropertyValues (Newtonsoft.Json.JsonWriter writer, System.Object value, Newtonsoft.Json.Serialization.JsonContainerContract contract, Newtonsoft.Json.Serialization.JsonProperty member, Newtonsoft.Json.Serialization.JsonProperty property, Newtonsoft.Json.Serialization.JsonContract&amp; memberContract, System.Object&amp; memberValue) [0x00000] in &lt;filename unknown&gt;:0 
  at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject (Newtonsoft.Json.JsonWriter writer, System.Object value, Newtonsoft.Json.Serialization.JsonObjectContract contract, Newtonsoft.Json.Serialization.JsonProperty member, Newtonsoft.Json.Serialization.JsonContainerContract collectionContract, Newtonsoft.Json.Serialization.JsonProperty containerProperty) [0x00000] in &lt;filename unknown&gt;:0 
</pre>{% endraw %}
                        </div>[DOUBLEPOST=1447070523,1447050284][/DOUBLEPOST]In the event someone might know whats going on, Ill go ahead and provide my data writing method as well.<br />
                        <br />
                        <div class="bbCodeBlock bbCodeCode">
                            <div class="type">Code:</div>
                            {% raw %}<pre>
         void WriteKingData(string path)
        {
            DynamicConfigFile data = Interface.GetMod().DataFileSystem.GetDatafile(path);
            data.Settings.ReferenceLoopHandling = ReferenceLoopHandling.Ignore;            Dictionary&lt;string, object&gt; profileData = new Dictionary&lt;string, object&gt;();            KingClass kData = King;
            profileData.Add(&quot;KingID&quot;, kData.ID);
            profileData.Add(&quot;KingName&quot;, kData.Name);
            profileData.Add(&quot;RealmName&quot;, kData.Realm);
            profileData.Add(&quot;TaxPercent&quot;, kData.Tax);
            profileData.Add(&quot;TaxBox&quot;, kData.TaxBox); // This is what is failing            data[&quot;KingData&quot;] = profileData;            Interface.GetMod().DataFileSystem.SaveDatafile(path);
        }
</pre>{% endraw %}
                        </div>
                        <div class="messageTextEndMarker">&nbsp;</div>
                    </blockquote>
                </article>
            </div>
            <div class="messageMeta ToggleTriggerAnchor">
                <div class="privateControls">
                    <span class="item muted">
                        <span class="authorEnd"><a class="username author" dir="auto">Mythikos</a>,</span>
                        <a href="{{ '/threads/saving-lootcontainers-to-a-json-file.12688/#post-142399' | prepend: site.baseurl }}" title="Permalink" class="datePermalink"><span class="DateTime"
                                title="Nov 9, 2015 at 12:02 PM">Nov 9, 2015</span></a>
                    </span>
                </div>
                <div class="publicControls">
                    <a href="{{ '/threads/saving-lootcontainers-to-a-json-file.12688/#post-142399' | prepend: site.baseurl }}" title="Permalink"
                        class="item muted postNumber hashPermalink OverlayTrigger" data-href="posts/142399/permalink">#3</a>
                </div>
            </div>
        </div>
    </li>
    <li id="post-142487" class="message staff" data-author="Calytic">
        <div class="messageUserInfo">
            <div class="messageUserBlock">
                <div class="avatarHolder">
                    <span class="helper"></span>
                    <a href="members/calytic.58712/" class="avatar Avm" data-avatarhtml="true"><img src="data/avatars/m/58/58712.jpg?1463423255" width="96" height="96" alt="Calytic" /></a>
                </div>
                <h3 class="userText">
                    <a href="members/calytic.58712/" class="username" dir="auto" itemprop="name">Calytic</a>
                    <em class="userBanner bannerRed wrapped" itemprop="title"><span class="before"></span><strong>Community Admin</strong><span class="after"></span></em>
                    <em class="userBanner bannerGreen wrapped" itemprop="title"><span class="before"></span><strong>Community Mod</strong><span class="after"></span></em>
                </h3>
                <span class="arrow"></span>
            </div>
        </div>
        <div class="messageInfo primaryContent">
            <div class="messageContent">
                <article>
                    <blockquote class="messageText SelectQuoteContainer ugc baseHtml"> You&#039;re not using the DynamicConfigFile that has ReferenceLoopHandling.Ignore. You can probably set it on the
                        main datafilesystem but I don&#039;t have any reference code for that.<br />
                        <br /> To write the data you need something like..<br />
                        <div class="bbCodeBlock bbCodeCode">
                            <div class="type">Code:</div>
                            {% raw %}<pre>
data.WriteObject&lt;Dictionary&lt;string, object&gt;&gt;(profileData);
</pre>{% endraw %}
                        </div>
                        <div class="messageTextEndMarker">&nbsp;</div>
                    </blockquote>
                </article>
            </div>
            <div class="messageMeta ToggleTriggerAnchor">
                <div class="privateControls">
                    <span class="item muted">
                        <span class="authorEnd"><a href="members/calytic.58712/" class="username author" dir="auto">Calytic</a>,</span>
                        <a href="{{ '/threads/saving-lootcontainers-to-a-json-file.12688/#post-142487' | prepend: site.baseurl }}" title="Permalink" class="datePermalink"><span class="DateTime"
                                title="Nov 9, 2015 at 3:54 PM">Nov 9, 2015</span></a>
                    </span>
                </div>
                <div class="publicControls">
                    <a href="{{ '/threads/saving-lootcontainers-to-a-json-file.12688/#post-142487' | prepend: site.baseurl }}" title="Permalink"
                        class="item muted postNumber hashPermalink OverlayTrigger" data-href="posts/142487/permalink">#4</a>
                </div>
            </div>
        </div>
    </li>
    <li id="post-142651" class="message" data-author="Mythikos">
        <div class="messageUserInfo">
            <div class="messageUserBlock">
                <div class="avatarHolder">
                    <span class="helper"></span>
                    <a class="avatar Avm" data-avatarhtml="true"><img src="{{ '/assets/styles/oxide/logo.og.png' | prepend: site.baseurl }}" width="96" height="96" alt="Mythikos" /></a>
                </div>
                <h3 class="userText">
                    <a class="username" dir="auto">Mythikos</a>
                </h3>
                <span class="arrow"></span>
            </div>
        </div>
        <div class="messageInfo primaryContent">
            <div class="messageContent">
                <article>
                    <blockquote class="messageText SelectQuoteContainer ugc baseHtml">
                        <div class="bbCodeBlock bbCodeQuote" data-author="Calytic">
                            <aside>
                                <div class="attribution type">Calytic said: <a href="#post-142487" class="AttributionLink">&uarr;</a>
                                </div>
                                <blockquote class="quoteContainer">
                                    <div class="quote">You&#039;re not using the DynamicConfigFile that has ReferenceLoopHandling.Ignore. You can probably set it on the main datafilesystem but I
                                        don&#039;t have any reference code for that.<br />
                                        <br /> To write the data you need something like..<br />
                                        <div class="bbCodeBlock bbCodeCode">
                                            <div class="type">Code:</div>
                                            {% raw %}<pre>
data.WriteObject&lt;Dictionary&lt;string, object&gt;&gt;(profileData);
</pre>{% endraw %}
                                        </div>
                                    </div>
                                    <div class="quoteExpand">Click to expand...</div>
                                </blockquote>
                            </aside>
                        </div>Would I just use the that line of code over Interface.GetMod().DataFileSystem.SaveDataFile(path);?<br /> [DOUBLEPOST=1447147356,1447111150][/DOUBLEPOST]I literally spent
                        the entire day trying to do this. I tried changing the entire system to use <br />
                        <div class="bbCodeBlock bbCodeCode">
                            <div class="type">Code:</div>
                            {% raw %}<pre>
data.ReadObject&lt;Dictionary&lt;string, object&gt;&gt;(profileData);
data.WriteObject&lt;Dictionary&lt;string, object&gt;&gt;(profileData);
</pre>{% endraw %}
                        </div>I tried modifying my original system and modifying it like<br />
                        <div class="bbCodeBlock bbCodeCode">
                            <div class="type">Code:</div>
                            {% raw %}<pre>
DynamicConfigFile data =Interface.GetMod().DataFileSystem.GetDatafile(path);
Interface.GetMod().DataFileSystem.SaveDatafile(path);
</pre>{% endraw %}
                        </div>I can not get a system working that saves StorageContainers. Can someone please help me or perhaps provide some example code? Ive scanned the plugins for rust
                        experimental and I couldn&#039;t find one that saves StorageContainers. I am at a total loss, any help would be very much appreciated. <div class="messageTextEndMarker">&nbsp;
                        </div>
                    </blockquote>
                </article>
            </div>
            <div class="messageMeta ToggleTriggerAnchor">
                <div class="privateControls">
                    <span class="item muted">
                        <span class="authorEnd"><a class="username author" dir="auto">Mythikos</a>,</span>
                        <a href="{{ '/threads/saving-lootcontainers-to-a-json-file.12688/#post-142651' | prepend: site.baseurl }}" title="Permalink" class="datePermalink"><span class="DateTime"
                                title="Nov 10, 2015 at 9:22 AM">Nov 10, 2015</span></a>
                    </span>
                </div>
                <div class="publicControls">
                    <a href="{{ '/threads/saving-lootcontainers-to-a-json-file.12688/#post-142651' | prepend: site.baseurl }}" title="Permalink"
                        class="item muted postNumber hashPermalink OverlayTrigger" data-href="posts/142651/permalink">#5</a>
                </div>
            </div>
        </div>
    </li>
    <li id="post-142736" class="message staff" data-author="Calytic">
        <div class="messageUserInfo">
            <div class="messageUserBlock">
                <div class="avatarHolder">
                    <span class="helper"></span>
                    <a href="members/calytic.58712/" class="avatar Avm" data-avatarhtml="true"><img src="data/avatars/m/58/58712.jpg?1463423255" width="96" height="96" alt="Calytic" /></a>
                </div>
                <h3 class="userText">
                    <a href="members/calytic.58712/" class="username" dir="auto" itemprop="name">Calytic</a>
                    <em class="userBanner bannerRed wrapped" itemprop="title"><span class="before"></span><strong>Community Admin</strong><span class="after"></span></em>
                    <em class="userBanner bannerGreen wrapped" itemprop="title"><span class="before"></span><strong>Community Mod</strong><span class="after"></span></em>
                </h3>
                <span class="arrow"></span>
            </div>
        </div>
        <div class="messageInfo primaryContent">
            <div class="messageContent">
                <article>
                    <blockquote class="messageText SelectQuoteContainer ugc baseHtml"> Alright well, you cant save storage containers in oxide data files. In-game entities are only reliably saved in
                        the worldsave file. Look at my mod EntityOwner. I create a reference list keyed by a unique ID for entities based on their position (GetEntityID)<br />
                        <br />
                        <div class="bbCodeBlock bbCodeCode">
                            <div class="type">Code:</div>
                            {% raw %}<pre>public static string GetEntityID(BaseEntity entity)
{
    Vector3 position = entity.transform.position;
    return &quot;x&quot; + position.x + &quot;y&quot; + position.y + &quot;z&quot; + position.z;
}</pre>{% endraw %}
                        </div>This unique ID is then used in conjunction with the userID of the player to determine who owns the box (or any entity). You don&#039;t really need to be storing the
                        Vector3 or StorageContainer instance itself. You just need to know its position. Then, anytime anyone interacts with any box, you check it against your reference list to see if
                        it one of your &quot;special&quot; boxes and do something different with it. <div class="messageTextEndMarker">&nbsp;</div>
                    </blockquote>
                </article>
            </div>
            <div class="messageMeta ToggleTriggerAnchor">
                <div class="privateControls">
                    <span class="item muted">
                        <span class="authorEnd"><a href="members/calytic.58712/" class="username author" dir="auto">Calytic</a>,</span>
                        <a href="{{ '/threads/saving-lootcontainers-to-a-json-file.12688/#post-142736' | prepend: site.baseurl }}" title="Permalink" class="datePermalink"><span class="DateTime"
                                title="Nov 10, 2015 at 11:01 AM">Nov 10, 2015</span></a>
                    </span>
                </div>
                <div class="publicControls">
                    <a href="{{ '/threads/saving-lootcontainers-to-a-json-file.12688/#post-142736' | prepend: site.baseurl }}" title="Permalink"
                        class="item muted postNumber hashPermalink OverlayTrigger" data-href="posts/142736/permalink">#6</a>
                </div>
            </div>
        </div>
    </li>
    <li id="post-142973" class="message" data-author="Mythikos">
        <div class="messageUserInfo">
            <div class="messageUserBlock">
                <div class="avatarHolder">
                    <span class="helper"></span>
                    <a class="avatar Avm" data-avatarhtml="true"><img src="{{ '/assets/styles/oxide/logo.og.png' | prepend: site.baseurl }}" width="96" height="96" alt="Mythikos" /></a>
                </div>
                <h3 class="userText">
                    <a class="username" dir="auto">Mythikos</a>
                </h3>
                <span class="arrow"></span>
            </div>
        </div>
        <div class="messageInfo primaryContent">
            <div class="messageContent">
                <article>
                    <blockquote class="messageText SelectQuoteContainer ugc baseHtml"> I took your advice <a href="https://oxidemod.org/members/58712/" class="username"
                            data-user="58712, @Calytic">@Calytic</a> and I got it mostly working. <div class="messageTextEndMarker">&nbsp;</div>
                    </blockquote>
                </article>
            </div>
            <div class="editDate"> Last edited by a moderator: <span class="DateTime" title="Nov 13, 2015 at 7:19 AM">Nov 13, 2015</span>
            </div>
            <div class="messageMeta ToggleTriggerAnchor">
                <div class="privateControls">
                    <span class="item muted">
                        <span class="authorEnd"><a class="username author" dir="auto">Mythikos</a>,</span>
                        <a href="{{ '/threads/saving-lootcontainers-to-a-json-file.12688/#post-142973' | prepend: site.baseurl }}" title="Permalink" class="datePermalink"><span class="DateTime"
                                title="Nov 11, 2015 at 7:05 AM">Nov 11, 2015</span></a>
                    </span>
                </div>
                <div class="publicControls">
                    <a href="{{ '/threads/saving-lootcontainers-to-a-json-file.12688/#post-142973' | prepend: site.baseurl }}" title="Permalink"
                        class="item muted postNumber hashPermalink OverlayTrigger" data-href="posts/142973/permalink">#7</a>
                </div>
            </div>
        </div>
    </li>
</ol>
