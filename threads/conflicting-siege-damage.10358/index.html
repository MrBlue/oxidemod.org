---
layout: forums
title: 'Conflicting siege damage'
breadcrumbs:
 - "Game Discussion": "/categories/game-discussion.106/"
 - "Reign of Kings Discussion": "/forums/reign-of-kings-discussion.62/"
---
<div class="titleBar">
    <h1>
        <a href="{{ '/threads/conflicting-siege-damage.10358/' | prepend: site.baseurl }}">Conflicting siege damage</a>
    </h1>
    <p id="pageDescription" class="muted">Discussion in '<a href="{{ '/forums/reign-of-kings-discussion.62/' | prepend: site.baseurl }}">Reign of Kings Discussion</a>' started by <a class="username"
            dir="auto">Sharpstar</a>, <a href="{{ '/threads/conflicting-siege-damage.10358/' | prepend: site.baseurl }}"><span class="DateTime" title="Jul 20, 2015 at 12:32 AM">Jul 20,
                2015</span></a>.
    </p>
</div>
<ol class="messageList" id="messageList">
    <li id="post-109816" class="message" data-author="Sharpstar">
        <div class="messageUserInfo">
            <div class="messageUserBlock">
                <div class="avatarHolder">
                    <span class="helper"></span>
                    <a class="avatar Avm" data-avatarhtml="true"><img src="{{ '/assets/styles/oxide/logo.og.png' | prepend: site.baseurl }}" width="96" height="96" alt="Sharpstar" /></a>
                </div>
                <h3 class="userText">
                    <a class="username" dir="auto">Sharpstar</a>
                </h3>
                <span class="arrow"></span>
            </div>
        </div>
        <div class="messageInfo primaryContent">
            <div class="messageContent">
                <article>
                    <blockquote class="messageText SelectQuoteContainer ugc baseHtml">Greetings,<br />
                        <br /> Our server currently has both WarTime and WarTracker running. WarTime is supposed to be providing the block protection and allowing Admins to approve wars so we can
                        moderate them. Currently, we are having an issue with siege damage. Ballista Bolts will do damage and report in chat, but I understand Trebs are still not doing so. At the
                        moment, the Ballista seems to do 100 damage per shot, however the Treb damage widely varies. Even with WarTime set to Peace, Trebs are doing damage. <br />
                        <br /> I am not sure if these plugins might be conflicting with one another or if it could be something else. Has anyone seen a similar issue? <div
                            class="messageTextEndMarker">&nbsp;</div>
                    </blockquote>
                </article>
            </div>
            <div class="messageMeta ToggleTriggerAnchor">
                <div class="privateControls">
                    <span class="item muted">
                        <span class="authorEnd"><a class="username author" dir="auto">Sharpstar</a>,</span>
                        <a href="{{ '/threads/conflicting-siege-damage.10358/' | prepend: site.baseurl }}" title="Permalink" class="datePermalink"><span class="DateTime"
                                title="Jul 20, 2015 at 12:32 AM">Jul 20, 2015</span></a>
                    </span>
                </div>
                <div class="publicControls">
                    <a href="{{ '/threads/conflicting-siege-damage.10358/' | prepend: site.baseurl }}" title="Permalink" class="item muted postNumber hashPermalink OverlayTrigger"
                        data-href="posts/109816/permalink">#1</a>
                </div>
            </div>
        </div>
    </li>
    <li id="post-109842" class="message" data-author="Wiken[SWE]">
        <div class="messageUserInfo">
            <div class="messageUserBlock">
                <div class="avatarHolder">
                    <span class="helper"></span>
                    <a class="avatar Avm" data-avatarhtml="true"><img src="{{ '/assets/styles/oxide/logo.og.png' | prepend: site.baseurl }}" width="96" height="96" alt="Wiken[SWE]" /></a>
                </div>
                <h3 class="userText">
                    <a class="username" dir="auto">Wiken[SWE]</a>
                </h3>
                <span class="arrow"></span>
            </div>
        </div>
        <div class="messageInfo primaryContent">
            <div class="messageContent">
                <article>
                    <blockquote class="messageText SelectQuoteContainer ugc baseHtml">The plugins are not working properly, i&#039;m quite sure of it. <div class="messageTextEndMarker">&nbsp;</div>
                    </blockquote>
                </article>
            </div>
            <div class="messageMeta ToggleTriggerAnchor">
                <div class="privateControls">
                    <span class="item muted">
                        <span class="authorEnd"><a class="username author" dir="auto">Wiken[SWE]</a>,</span>
                        <a href="{{ '/threads/conflicting-siege-damage.10358/#post-109842' | prepend: site.baseurl }}" title="Permalink" class="datePermalink"><span class="DateTime"
                                title="Jul 20, 2015 at 1:56 AM">Jul 20, 2015</span></a>
                    </span>
                </div>
                <div class="publicControls">
                    <a href="{{ '/threads/conflicting-siege-damage.10358/#post-109842' | prepend: site.baseurl }}" title="Permalink" class="item muted postNumber hashPermalink OverlayTrigger"
                        data-href="posts/109842/permalink">#2</a>
                </div>
            </div>
        </div>
    </li>
    <li id="post-109847" class="message" data-author="Sharpstar">
        <div class="messageUserInfo">
            <div class="messageUserBlock">
                <div class="avatarHolder">
                    <span class="helper"></span>
                    <a class="avatar Avm" data-avatarhtml="true"><img src="{{ '/assets/styles/oxide/logo.og.png' | prepend: site.baseurl }}" width="96" height="96" alt="Sharpstar" /></a>
                </div>
                <h3 class="userText">
                    <a class="username" dir="auto">Sharpstar</a>
                </h3>
                <span class="arrow"></span>
            </div>
        </div>
        <div class="messageInfo primaryContent">
            <div class="messageContent">
                <article>
                    <blockquote class="messageText SelectQuoteContainer ugc baseHtml">We have had some strange issues. Unloading both plugins would still not permit damage. Sometimes you could do
                        siege damage, and then it would suddenly stop working.<br />
                        <br /> I removed WarTracker entirely and it seems that /wartime is doing some of what I had hoped. Right now it does prevent Ballista damage, announce it in chat, and permit it
                        when toggled to war. <br />
                        <br /> Trebuchets are still not announced at all and are able to do damage in peace or war. It also seems to be doing a considerable amount. 1 Trebuchet Stone will do 30,000 -
                        50,000 damage no matter what. I know it can/will do splash damage and impact multiple blocks, but that seems rather high indeed. <div class="messageTextEndMarker">&nbsp;</div>
                    </blockquote>
                </article>
            </div>
            <div class="editDate">Last edited by a moderator: <span class="DateTime" title="Jul 20, 2015 at 3:20 AM">Jul 20, 2015</span>
            </div>
            <div class="messageMeta ToggleTriggerAnchor">
                <div class="privateControls">
                    <span class="item muted">
                        <span class="authorEnd"><a class="username author" dir="auto">Sharpstar</a>,</span>
                        <a href="{{ '/threads/conflicting-siege-damage.10358/#post-109847' | prepend: site.baseurl }}" title="Permalink" class="datePermalink"><span class="DateTime"
                                title="Jul 20, 2015 at 2:41 AM">Jul 20, 2015</span></a>
                    </span>
                </div>
                <div class="publicControls">
                    <a href="{{ '/threads/conflicting-siege-damage.10358/#post-109847' | prepend: site.baseurl }}" title="Permalink" class="item muted postNumber hashPermalink OverlayTrigger"
                        data-href="posts/109847/permalink">#3</a>
                </div>
            </div>
        </div>
    </li>
    <li id="post-110264" class="message" data-author="SweetLouHD">
        <div class="messageUserInfo">
            <div class="messageUserBlock">
                <div class="avatarHolder">
                    <span class="helper"></span>
                    <a class="avatar Avm" data-avatarhtml="true"><img src="{{ '/assets/styles/oxide/logo.og.png' | prepend: site.baseurl }}" width="96" height="96" alt="SweetLouHD" /></a>
                </div>
                <h3 class="userText">
                    <a class="username" dir="auto">SweetLouHD</a>
                </h3>
                <span class="arrow"></span>
            </div>
        </div>
        <div class="messageInfo primaryContent">
            <div class="messageContent">
                <article>
                    <blockquote class="messageText SelectQuoteContainer ugc baseHtml">are you using Grand Exchange?<br /> I remember there being a problem with that plugin causing trebs to not
                        damage.<br />
                        <br /> However that could of been fixed. Still a good idea to check the support forum for the plugins in questions. <div class="messageTextEndMarker">&nbsp;</div>
                    </blockquote>
                </article>
            </div>
            <div class="messageMeta ToggleTriggerAnchor">
                <div class="privateControls">
                    <span class="item muted">
                        <span class="authorEnd"><a class="username author" dir="auto">SweetLouHD</a>,</span>
                        <a href="{{ '/threads/conflicting-siege-damage.10358/#post-110264' | prepend: site.baseurl }}" title="Permalink" class="datePermalink"><span class="DateTime"
                                title="Jul 21, 2015 at 8:43 AM">Jul 21, 2015</span></a>
                    </span>
                </div>
                <div class="publicControls">
                    <a href="{{ '/threads/conflicting-siege-damage.10358/#post-110264' | prepend: site.baseurl }}" title="Permalink" class="item muted postNumber hashPermalink OverlayTrigger"
                        data-href="posts/110264/permalink">#4</a>
                </div>
            </div>
        </div>
    </li>
    <li id="post-110301" class="message" data-author="Sharpstar">
        <div class="messageUserInfo">
            <div class="messageUserBlock">
                <div class="avatarHolder">
                    <span class="helper"></span>
                    <a class="avatar Avm" data-avatarhtml="true"><img src="{{ '/assets/styles/oxide/logo.og.png' | prepend: site.baseurl }}" width="96" height="96" alt="Sharpstar" /></a>
                </div>
                <h3 class="userText">
                    <a class="username" dir="auto">Sharpstar</a>
                </h3>
                <span class="arrow"></span>
            </div>
        </div>
        <div class="messageInfo primaryContent">
            <div class="messageContent">
                <article>
                    <blockquote class="messageText SelectQuoteContainer ugc baseHtml">Fraccas has apparently stopped supporting WarTime it would seem. I did some reading on Grand Exchange that
                        suggested it might limit or prevent Treb damage, but my problem really is that I have no way of preventing Treb damage. It always seems to work, no matter what. I did remove
                        Grand Exchange entirely thinking maybe that would help, but it did not. I actually removed all of our plugins except WarTime and rebooted the server. Same problem. Removed
                        WarTime and reinstalled a clear version. Same problem.<br />
                        <br /> The Logs plugin seems to not pick up Treb damage either apparently, at least some people on that thread seem to be having that issue anyway. I am just wondering if
                        CodeHatch changed something about the Treb that means the line of code that is supposed to be catching it needs to be updated.<br />
                        [DOUBLEPOST=1437505487,1437479853][/DOUBLEPOST] <div class="bbCodeBlock bbCodeCode">
                            <div class="type">Code:</div>
                            {% raw %}<pre>
void OnCubeTakeDamage(CubeDamageEvent e) {
try {
if (keysMatched &amp;&amp; e != null) { 
{if (waron)
{if (e.Damage.Amount &gt; 50) 
{ if (e.Damage.DamageSource.Owner is Player &amp;&amp; e.Entity.Owner is Player) 
{ bool treb = e.Damage.Damager.name.ToString().Contains(&quot;Trebuchet&quot;); 
bool ballista = e.Damage.Damager.name.ToString().Contains(&quot;Ballista&quot;);
if (treb || ballista)
{ if (offlineSiege)
{ if (announceSiegeInChat)
{ message = e.Damage.DamageSource.Owner.Name + &quot; has done &quot; + e.Damage.Amount.ToString() + &quot; to someone's property with a &quot; + e.Damage.Damager.name.ToString() + &quot;!&quot;; </pre>{% endraw %}
                        </div>This is the section in WarTime that most interests me. It DOES work for a Ballista just like it says. If War is on, the damage amount is more than 50, the damage source
                        and entity owner is the player, offline siege is on, and if siege announce is on then it says in chat that &quot;Player Name has done 100 dmg to someone&#039;s property with a
                        Ballista&quot;.<br />
                        <br /> However, the Treb portion of the section does not work and will not announce the damage. Similarly, the Treb portion of the no damage outside of War section does not
                        work and will allow damage regardless. That section is here I believe:<br />
                        <br />
                        <div class="bbCodeBlock bbCodeCode">
                            <div class="type">Code:</div>
                            {% raw %}<pre>
} else { bool treb = e.Damage.Damager.name.ToString().Contains(&quot;Trebuchet&quot;);
if (treb) {  Puts(&quot;A base was attacked with a &quot; + e.Damage.Damager.name.ToString());       
Puts(&quot;It is peace time so the treb stone did zero damage!&quot;);                                    
e.Damage.Amount = 0; }    } } </pre>{% endraw %}
                        </div>My first thought is that something changed in how the Treb is listed so &lt;e.Damage.Damager.name.ToString().Contains(&quot;Trebuchet&quot;)&gt; is no longer working and
                        thus not announcing or preventing damage because the plugin is searching for a Damager that does not exist; this seems to work for the Ballista as-is which made me think
                        something had possibly changed. <br />
                        <br /> The interesting side is that Logs seems to record both such as:<br />
                        <br />
                        <div class="bbCodeBlock bbCodeCode">
                            <div class="type">Code:</div>
                            {% raw %}<pre>
Cubes: Sharpstar has done 0.1039088 [OutOfBounds, Siege] damage points to a cube with a [Entity] Explosion Trebuchet (900) at [-280,145,852].
Cubes: Sharpstar has done 100 [Siege] damage points to a cube with a [Entity] Ballista Bolt at [-282,145,862].
</pre>{% endraw %}
                        </div>Now, the damage amount is wrong on the Treb and I am not sure what the OutOfBounds means, but it is an entity attached to the player name doing damage and containing the
                        word Trebuchet. Changing Trebuchet to Explosion Trebuchet did not resolve the issue. Changing the Damage threshold from &gt; 50 to &gt; 0 or &gt; -1 did not work either,
                        although the Ballista was still working just fine.<br />
                        <br /> Just to further cloud the question, the Pwn plugin seems to amplify the damage of a Treb if you have it on when you shoot. I was looking at that code trying to figure
                        out how it might be identifying the Treb and if I could modify that code somewhat and use it in WarTime to pick up the Treb again. That code is here:<br />
                        <br />
                        <div class="bbCodeBlock bbCodeCode">
                            <div class="type">Code:</div>
                            {% raw %}<pre>
void OnCubeTakeDamage(CubeDamageEvent e) {             
Player damager = e.Damage.DamageSource.Owner;
if (!pwn) return;            
if (!damager.HasPermission(&quot;admin&quot;)) return;
if(e.Damage.Amount &lt; 0) {
e.Damage.Amount = pwnRepair;
PrintToChat(damager, &quot;PWN repair! healing &quot; + pwnRepair.ToString() + &quot; damage.&quot;);
return;
}
PrintToChat(damager, &quot;PWN hit! dealing &quot; + pwnDMG.ToString() + &quot; damage.&quot;);   
e.Damage.Amount = pwnDMG;                       
        }
}
</pre>{% endraw %}
                        </div>Pwn seems to say that &#039;damager&#039; is &lt;e.Damage.DamageSource.Owner;&gt; and that if Pwn is on, the user has permission for it, and the damage amount is &lt; 0
                        it heals or &gt; 0 it does damage. That works just fine and it amplifies the Treb&#039;s damage as well. So, I assume I am showing up as the &#039;damager&#039; or
                        &lt;e.Damage.DamageSource.Owner;&gt; for the damage done by the Treb, which makes me think that I am missing something somewhere.<br />
                        <br /> Thoughts? <div class="messageTextEndMarker">&nbsp;</div>
                    </blockquote>
                </article>
            </div>
            <div class="messageMeta ToggleTriggerAnchor">
                <div class="privateControls">
                    <span class="item muted">
                        <span class="authorEnd"><a class="username author" dir="auto">Sharpstar</a>,</span>
                        <a href="{{ '/threads/conflicting-siege-damage.10358/#post-110301' | prepend: site.baseurl }}" title="Permalink" class="datePermalink"><span class="DateTime"
                                title="Jul 21, 2015 at 8:04 PM">Jul 21, 2015</span></a>
                    </span>
                </div>
                <div class="publicControls">
                    <a href="{{ '/threads/conflicting-siege-damage.10358/#post-110301' | prepend: site.baseurl }}" title="Permalink" class="item muted postNumber hashPermalink OverlayTrigger"
                        data-href="posts/110301/permalink">#5</a>
                </div>
            </div>
        </div>
    </li>
    <li id="post-110596" class="message" data-author="SweetLouHD">
        <div class="messageUserInfo">
            <div class="messageUserBlock">
                <div class="avatarHolder">
                    <span class="helper"></span>
                    <a class="avatar Avm" data-avatarhtml="true"><img src="{{ '/assets/styles/oxide/logo.og.png' | prepend: site.baseurl }}" width="96" height="96" alt="SweetLouHD" /></a>
                </div>
                <h3 class="userText">
                    <a class="username" dir="auto">SweetLouHD</a>
                </h3>
                <span class="arrow"></span>
            </div>
        </div>
        <div class="messageInfo primaryContent">
            <div class="messageContent">
                <article>
                    <blockquote class="messageText SelectQuoteContainer ugc baseHtml">Did a quick test and this worked at nullifying only treb damage.<br />
                        <br />
                        <div class="bbCodeBlock bbCodeCode">
                            <div class="type">Code:</div>
                            {% raw %}<pre>
using System;
using System.Collections.Generic;using CodeHatch.Build;
using CodeHatch.Engine.Networking;using CodeHatch.Engine.Core.Networking;
using CodeHatch.Blocks;
using CodeHatch.Blocks.Networking.Events;
using CodeHatch.Networking.Events.Entities;
using CodeHatch.Networking.Events.Entities.Players;
using CodeHatch.Networking.Events.Players;
using CodeHatch.Networking.Events.Social;namespace Oxide.Plugins
{
    [Info(&quot;Damager&quot;, &quot;SweetLouHD&quot;, &quot;0.0.1&quot;)]
    public class Damager : ReignOfKingsPlugin
    {
        void OnCubeTakeDamage(CubeDamageEvent e) {
            bool treb = e.Damage.Damager.name.ToString().Contains(&quot;Trebuchet&quot;);
            if(treb)
            {
                e.Damage.Amount = 0;
                PrintToChat(&quot;Damage was nullified.&quot;);
            } else {
                PrintToChat(&quot;Damage was delt from something else.&quot;);
            }
        }
    }
}</pre>{% endraw %}
                        </div>
                        <div class="messageTextEndMarker">&nbsp;</div>
                    </blockquote>
                </article>
            </div>
            <div class="messageMeta ToggleTriggerAnchor">
                <div class="privateControls">
                    <span class="item muted">
                        <span class="authorEnd"><a class="username author" dir="auto">SweetLouHD</a>,</span>
                        <a href="{{ '/threads/conflicting-siege-damage.10358/#post-110596' | prepend: site.baseurl }}" title="Permalink" class="datePermalink"><span class="DateTime"
                                title="Jul 22, 2015 at 11:03 AM">Jul 22, 2015</span></a>
                    </span>
                </div>
                <div class="publicControls">
                    <a href="{{ '/threads/conflicting-siege-damage.10358/#post-110596' | prepend: site.baseurl }}" title="Permalink" class="item muted postNumber hashPermalink OverlayTrigger"
                        data-href="posts/110596/permalink">#6</a>
                </div>
            </div>
        </div>
    </li>
    <li id="post-111378" class="message" data-author="Sharpstar">
        <div class="messageUserInfo">
            <div class="messageUserBlock">
                <div class="avatarHolder">
                    <span class="helper"></span>
                    <a class="avatar Avm" data-avatarhtml="true"><img src="{{ '/assets/styles/oxide/logo.og.png' | prepend: site.baseurl }}" width="96" height="96" alt="Sharpstar" /></a>
                </div>
                <h3 class="userText">
                    <a class="username" dir="auto">Sharpstar</a>
                </h3>
                <span class="arrow"></span>
            </div>
        </div>
        <div class="messageInfo primaryContent">
            <div class="messageContent">
                <article>
                    <blockquote class="messageText SelectQuoteContainer ugc baseHtml">I have resolved the issue. The current version of WarTracker does not provide block protection, so it was not
                        that. The current version of WarTime doesn&#039;t either, but a little playing with it will make sure it at least kicks or bans people. We actually had an updated paid version
                        of WarTime that was meant to control block damage by siege weapons and also make crests immune among other features. Once we threw that code into an editor, we realized it had
                        a great many errors and that it would not really be worth our time to try and resolve them all.<br />
                        <br /> We ended up just starting fresh with a blank page and coded our own War plugin and were able to get it to prevent block damage from any siege engine outside of war and
                        announce it all through chat. We also managed to get crest protection in there as well.<br />
                        <br /> We are finally back in a good spot xD <div class="messageTextEndMarker">&nbsp;</div>
                    </blockquote>
                </article>
            </div>
            <div class="messageMeta ToggleTriggerAnchor">
                <div class="privateControls">
                    <span class="item muted">
                        <span class="authorEnd"><a class="username author" dir="auto">Sharpstar</a>,</span>
                        <a href="{{ '/threads/conflicting-siege-damage.10358/#post-111378' | prepend: site.baseurl }}" title="Permalink" class="datePermalink"><span class="DateTime"
                                title="Jul 23, 2015 at 9:54 PM">Jul 23, 2015</span></a>
                    </span>
                </div>
                <div class="publicControls">
                    <a href="{{ '/threads/conflicting-siege-damage.10358/#post-111378' | prepend: site.baseurl }}" title="Permalink" class="item muted postNumber hashPermalink OverlayTrigger"
                        data-href="posts/111378/permalink">#7</a>
                </div>
            </div>
        </div>
    </li>
</ol>
