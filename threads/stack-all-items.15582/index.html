---
layout: forums
title: 'Stack all items'
breadcrumbs:
 - "Plugin Development": "/forums/plugin-development.105/"
 - "Rust Development": "/forums/rust-development.4/"
---
<div class="titleBar">
    <h1>
        <a href="{{ '/threads/stack-all-items.15582/' | prepend: site.baseurl }}">Stack all items</a>
    </h1>
    <p id="pageDescription" class="muted">Discussion in '<a href="{{ '/forums/rust-development.4/' | prepend: site.baseurl }}">Rust Development</a>' started by <a class="username"
            dir="auto">Bonzaii</a>, <a href="{{ '/threads/stack-all-items.15582/' | prepend: site.baseurl }}"><span class="DateTime" title="Feb 9, 2016 at 8:26 AM">Feb 9, 2016</span></a>.
    </p>
</div>
<ol class="messageList" id="messageList">
    <li id="post-174628" class="message" data-author="Bonzaii">
        <div class="messageUserInfo">
            <div class="messageUserBlock">
                <div class="avatarHolder">
                    <span class="helper"></span>
                    <a class="avatar Avm" data-avatarhtml="true"><img src="{{ '/assets/styles/oxide/logo.og.png' | prepend: site.baseurl }}" width="96" height="96" alt="Bonzaii" /></a>
                </div>
                <h3 class="userText">
                    <a class="username" dir="auto">Bonzaii</a>
                </h3>
                <span class="arrow"></span>
            </div>
        </div>
        <div class="messageInfo primaryContent">
            <div class="messageContent">
                <article>
                    <blockquote class="messageText SelectQuoteContainer ugc baseHtml"> Hi all,<br />
                        <br /> I have a problem with my script and I am not sure how to rectify it. The idea is to stack all items of the same type to the biggest possible stacks with no care for
                        MaxStackable. This is my script<br />
                        <div class="bbCodeBlock bbCodeCode">
                            <div class="type">Code:</div>
                            {% raw %}<pre>Dictionary&lt;int, int&gt; items = new Dictionary&lt;int, int&gt;();
            Puts(&quot;Running stackall.&quot;);            List&lt;Item&gt; availableItems = player.inventory.containerMain.itemList;
            //availableItems.AddRange(player.inventory.containerBelt.itemList);
            //availableItems.AddRange(player.inventory.containerWear.itemList);            foreach (Item i in availableItems)
            {
                if (i.hasCondition) continue;
                if (i.MaxStackable() == 1) continue;
                //if (i.amount &lt;= 1) continue;
                if (items.ContainsKey(i.info.itemid))
                {
                    items[i.info.itemid] += i.amount;
                }
                else
                {
                    items.Add(i.info.itemid, i.amount);
                }
                i.amount = 0;
                Puts(&quot;Stacking &quot; + i.info.displayName.translated);
            }
            foreach (KeyValuePair&lt;int, int&gt; entry in items)
            {
                Item newItem = ItemManager.Create(ItemManager.FindItemDefinition(entry.Key), entry.Value);
                player.GiveItem(newItem);
            }</pre>{% endraw %}
                        </div><br /> I have previously had problems with concurrent changes to a list/dictionary (whatever ItemContainer is) therefore I have copied all item list to availableItems (at
                        the moment only from containerMain).<br />
                        <br /> This should then go through all the items in availableItems list and take ID and AMOUNT of items that can be stacked are have no condition and remove them from
                        player&#039;s inventory. If this itemid was found previously it should just add the amount and remove item from player&#039;s inventory.<br />
                        <br /> Once search complete, add all items from items dictionary to the player&#039;s inventory.<br />
                        <br /> What am I doing wrong here? Last time I tried this script (twice in a row) it hacked my inventory to the point I had to kill myself (in game, obviously) and restart the
                        game to get it working back again.<br />
                        <br /> Any help will be appreciated.<br />
                        <br /> Thanks,<br /> Bonzaii <div class="messageTextEndMarker">&nbsp;</div>
                    </blockquote>
                </article>
            </div>
            <div class="messageMeta ToggleTriggerAnchor">
                <div class="privateControls">
                    <span class="item muted">
                        <span class="authorEnd"><a class="username author" dir="auto">Bonzaii</a>,</span>
                        <a href="{{ '/threads/stack-all-items.15582/' | prepend: site.baseurl }}" title="Permalink" class="datePermalink"><span class="DateTime" title="Feb 9, 2016 at 8:26 AM">Feb 9,
                                2016</span></a>
                    </span>
                </div>
                <div class="publicControls">
                    <a href="{{ '/threads/stack-all-items.15582/' | prepend: site.baseurl }}" title="Permalink" class="item muted postNumber hashPermalink OverlayTrigger"
                        data-href="posts/174628/permalink">#1</a>
                </div>
            </div>
        </div>
    </li>
</ol>
